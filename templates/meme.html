{% extends "base.html" %}

{% block title %}{{ meme.title or '–ú–µ–º' }} - MemePlatform{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <!-- Meme -->
        <div class="card">
            {% if meme.file_type == 'video' %}
            <video src="/data/uploads/{{ meme.filename }}" class="card-img-top" controls autoplay muted loop
                   style="max-height: 600px; object-fit: contain; background: #000;"></video>
            {% else %}
            <img src="/data/uploads/{{ meme.filename }}" class="card-img-top" 
                 alt="{{ meme.title or '–ú–µ–º' }}" 
                 style="max-height: 600px; object-fit: contain; background: #000;">
            {% endif %}
            
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        {% if meme.category_name %}
                        <span class="category-badge mb-2">
                            {{ meme.category_icon or 'üìÅ' }} {{ meme.category_name }}
                        </span>
                        {% endif %}
                        <h4 class="card-title mb-1">{{ meme.title or '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è' }}</h4>
                        <p class="text-muted small">
                            <i class="bi bi-clock"></i> {{ meme.created_at[:10] if meme.created_at else '' }}
                            ¬∑ –æ—Ç {{ meme.author_name or '–ê–Ω–æ–Ω–∏–º' }}
                        </p>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-outline-danger like-btn {% if meme.user_liked %}liked{% endif %}" data-id="{{ meme.id }}">
                            <i class="bi {% if meme.user_liked %}bi-heart-fill{% else %}bi-heart{% endif %}"></i>
                            <span class="like-count">{{ meme.likes_count or 0 }}</span>
                        </button>
                        <button class="btn btn-outline-primary btn-share" data-id="{{ meme.id }}">
                            <i class="bi bi-share"></i>
                        </button>
                        <a href="/data/uploads/{{ meme.filename }}" download class="btn btn-outline-success">
                            <i class="bi bi-download"></i>
                        </a>
                    </div>
                </div>
                
                {% if meme.description %}
                <p class="card-text">{{ meme.description }}</p>
                {% endif %}
                
                {% if meme.tags %}
                <div class="mb-3">
                    {% for tag in meme.tags.split(',') %}
                    <a href="/?search={{ tag.strip() }}" class="badge bg-secondary text-decoration-none me-1">
                        #{{ tag.strip() }}
                    </a>
                    {% endfor %}
                </div>
                {% endif %}
                
                <div class="d-flex gap-3 text-muted small">
                    <span><i class="bi bi-eye"></i> {{ meme.views_count or 0 }} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</span>
                    <span><i class="bi bi-share"></i> {{ meme.shares_count or 0 }} —Ä–∞–∑ –ø–æ–¥–µ–ª–∏–ª–∏—Å—å</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Sidebar -->
    <div class="col-lg-4">
        <div class="sidebar">
            <h5><i class="bi bi-fire"></i> –ü–æ—Ö–æ–∂–∏–µ –º–µ–º—ã</h5>
            
            {% if related_memes %}
                {% for rmeme in related_memes %}
                <div class="d-flex mb-3">
                    <a href="/meme/{{ rmeme.id }}" class="flex-shrink-0">
                        {% if rmeme.file_type == 'video' %}
                        <video src="/data/uploads/{{ rmeme.filename }}" 
                               style="width: 80px; height: 60px; object-fit: cover; border-radius: 8px;" muted></video>
                        {% else %}
                        <img src="/data/uploads/{{ rmeme.filename }}" 
                             style="width: 80px; height: 60px; object-fit: cover; border-radius: 8px;">
                        {% endif %}
                    </a>
                    <div class="ms-3">
                        <a href="/meme/{{ rmeme.id }}" class="text-white text-decoration-none">
                            {{ rmeme.title[:30] + '...' if rmeme.title and rmeme.title|length > 30 else rmeme.title or '–ú–µ–º' }}
                        </a>
                        <div class="small text-muted">
                            <i class="bi bi-heart"></i> {{ rmeme.likes_count or 0 }}
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
            <p class="text-muted">–ü–æ—Ö–æ–∂–∏—Ö –º–µ–º–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
            {% endif %}
        </div>
        
        <!-- Share block -->
        <div class="sidebar mt-4">
            <h5><i class="bi bi-share"></i> –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</h5>
            <div class="d-grid gap-2">
                <a href="https://t.me/share/url?url={{ request.url }}" target="_blank" 
                   class="btn btn-outline-info">
                    <i class="bi bi-telegram"></i> Telegram
                </a>
                <a href="https://vk.com/share.php?url={{ request.url }}" target="_blank" 
                   class="btn btn-outline-primary">
                    <i class="bi bi-share"></i> –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
                </a>
                <button class="btn btn-outline-secondary" onclick="copyLink()">
                    <i class="bi bi-clipboard"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function copyLink() {
        navigator.clipboard.writeText(window.location.href);
        alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
    }
</script>
{% endblock %}
