{% extends "base.html" %}

{% block title %}MemePlatform - –ì–∞–ª–µ—Ä–µ—è –º–µ–º–æ–≤{% endblock %}

{% block content %}
<div class="row">
    <!-- Sidebar -->
    <div class="col-lg-3">
        <div class="sidebar">
            <h5><i class="bi bi-grid"></i> –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h5>
            <ul class="category-list">
                <li>
                    <a href="/" class="{% if not current_category %}active{% endif %}">
                        <span class="cat-name"><span class="icon">üî•</span> –í—Å–µ –º–µ–º—ã</span>
                    </a>
                </li>
                {% for cat in categories %}
                <li>
                    <a href="/?category={{ cat.id }}" 
                       class="{% if current_category == cat.id %}active{% endif %}">
                        <span class="cat-name"><span class="icon">{{ cat.icon or 'üìÅ' }}</span> {{ cat.name }}</span>
                        <span class="badge bg-secondary">{{ cat.meme_count or 0 }}</span>
                    </a>
                </li>
                {% endfor %}
            </ul>
            
            <hr class="my-3" style="border-color: rgba(108, 92, 231, 0.3);">
            
            <h5><i class="bi bi-funnel"></i> –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</h5>
            <div class="btn-group-vertical w-100" role="group">
                <a href="?sort=new{% if current_category %}&category={{ current_category }}{% endif %}" 
                   class="btn btn-outline-primary btn-sm {% if sort == 'new' or not sort %}active{% endif %}">
                    <i class="bi bi-clock"></i> –ù–æ–≤—ã–µ
                </a>
                <a href="?sort=popular{% if current_category %}&category={{ current_category }}{% endif %}" 
                   class="btn btn-outline-primary btn-sm {% if sort == 'popular' %}active{% endif %}">
                    <i class="bi bi-heart"></i> –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ
                </a>
                <a href="?sort=views{% if current_category %}&category={{ current_category }}{% endif %}" 
                   class="btn btn-outline-primary btn-sm {% if sort == 'views' %}active{% endif %}">
                    <i class="bi bi-eye"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä—ã
                </a>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="col-lg-9">
        {% if search_query %}
        <div class="alert alert-info">
            <i class="bi bi-search"></i> –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞: "{{ search_query }}"
            <a href="/" class="btn btn-sm btn-outline-light float-end">–°–±—Ä–æ—Å–∏—Ç—å</a>
        </div>
        {% endif %}
        
        {% if memes %}
        <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4">
            {% for meme in memes %}
            <div class="col">
                <div class="card meme-card h-100">
                    <a href="/meme/{{ meme.id }}">
                        {% if meme.file_type == 'video' %}
                        <video src="/data/uploads/{{ meme.filename }}" muted></video>
                        {% else %}
                        <img src="/data/uploads/{{ meme.filename }}" alt="{{ meme.title or '–ú–µ–º' }}" loading="lazy">
                        {% endif %}
                    </a>
                    <div class="card-body">
                        {% if meme.category_name %}
                        <span class="category-badge mb-2 d-inline-block">
                            {{ meme.category_icon or 'üìÅ' }} {{ meme.category_name }}
                        </span>
                        {% endif %}
                        
                        <h6 class="card-title mb-1">
                            <a href="/meme/{{ meme.id }}" class="text-decoration-none text-white">
                                {{ meme.title or '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è' }}
                            </a>
                        </h6>
                        
                        <p class="card-text small text-muted mb-2">
                            {{ meme.description[:80] + '...' if meme.description and meme.description|length > 80 else meme.description or '' }}
                        </p>
                        
                        <div class="meme-stats">
                            <span class="like-btn {% if meme.user_liked %}liked{% endif %}" data-id="{{ meme.id }}">
                                <i class="bi {% if meme.user_liked %}bi-heart-fill{% else %}bi-heart{% endif %}"></i>
                                <span class="like-count">{{ meme.likes_count or 0 }}</span>
                            </span>
                            <span><i class="bi bi-eye"></i> {{ meme.views_count or 0 }}</span>
                            <span><i class="bi bi-share"></i> {{ meme.shares_count or 0 }}</span>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Pagination -->
        {% if total_pages > 1 %}
        <nav class="mt-4">
            <ul class="pagination justify-content-center">
                {% if page > 1 %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page - 1 }}{% if current_category %}&category={{ current_category }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}">
                        <i class="bi bi-chevron-left"></i>
                    </a>
                </li>
                {% endif %}
                
                {% for p in range(1, total_pages + 1) %}
                    {% if p == page %}
                    <li class="page-item active"><span class="page-link">{{ p }}</span></li>
                    {% elif p == 1 or p == total_pages or (p >= page - 2 and p <= page + 2) %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ p }}{% if current_category %}&category={{ current_category }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}">{{ p }}</a>
                    </li>
                    {% elif p == page - 3 or p == page + 3 %}
                    <li class="page-item disabled"><span class="page-link">...</span></li>
                    {% endif %}
                {% endfor %}
                
                {% if page < total_pages %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page + 1 }}{% if current_category %}&category={{ current_category }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}">
                        <i class="bi bi-chevron-right"></i>
                    </a>
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
        
        {% else %}
        <div class="text-center py-5">
            <i class="bi bi-emoji-frown display-1 text-muted"></i>
            <h3 class="mt-3">–ú–µ–º–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
            <p class="text-muted">–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –∑–∞–≥—Ä—É–∑–∏—Ç –º–µ–º!</p>
            <a href="/upload" class="btn btn-primary">
                <i class="bi bi-cloud-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–µ–º
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
